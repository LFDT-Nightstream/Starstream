---
source: starstream-to-wasm/tests/snapshots.rs
input_file: starstream-to-wasm/tests/inputs/blockheight.star
---
==== AST ====
Program {
    shebang: None,
    definitions: [
        Spanned {
            node: Import(
                ImportDef {
                    items: Named(
                        [
                            ImportNamedItem {
                                imported: Identifier {
                                    name: "blockHeight",
                                    span: Some(
                                        9..20,
                                    ),
                                },
                                local: Identifier {
                                    name: "blockHeight",
                                    span: Some(
                                        9..20,
                                    ),
                                },
                            },
                        ],
                    ),
                    from: ImportSource {
                        namespace: Identifier {
                            name: "starstream",
                            span: Some(
                                28..38,
                            ),
                        },
                        package: Identifier {
                            name: "std",
                            span: Some(
                                39..42,
                            ),
                        },
                        interface: Some(
                            Identifier {
                                name: "cardano",
                                span: Some(
                                    43..50,
                                ),
                            },
                        ),
                    },
                },
            ),
            span: 0..53,
            comments_before: [],
            comments_after: [],
        },
        Spanned {
            node: Function(
                FunctionDef {
                    export: Some(
                        Script,
                    ),
                    name: Identifier {
                        name: "reexport",
                        span: Some(
                            63..71,
                        ),
                    },
                    params: [],
                    return_type: Some(
                        TypeAnnotation {
                            name: Identifier {
                                name: "i64",
                                span: Some(
                                    77..80,
                                ),
                            },
                            generics: [],
                        },
                    ),
                    body: Block {
                        statements: [],
                        tail_expression: Some(
                            Spanned {
                                node: Runtime {
                                    expr: Spanned {
                                        node: Call {
                                            callee: Spanned {
                                                node: Identifier(
                                                    Identifier {
                                                        name: "blockHeight",
                                                        span: Some(
                                                            95..106,
                                                        ),
                                                    },
                                                ),
                                                span: 95..106,
                                                comments_before: [],
                                                comments_after: [],
                                            },
                                            args: [],
                                        },
                                        span: 95..109,
                                        comments_before: [],
                                        comments_after: [],
                                    },
                                },
                                span: 87..109,
                                comments_before: [],
                                comments_after: [],
                            },
                        ),
                    },
                },
            ),
            span: 53..111,
            comments_before: [],
            comments_after: [],
        },
    ],
}

==== Inference trace ====

T-Fn: reexport => i64
  T-ReturnTail: runtime blockHeight() => i64
    T-Runtime: {blockHeight: runtime fn() -> i64} ⊢ runtime blockHeight() ⇒ i64
      T-Call: {blockHeight: runtime fn() -> i64} ⊢ blockHeight() ⇒ i64
        T-Var: {blockHeight: runtime fn() -> i64} ⊢ blockHeight ⇒ runtime fn() -> i64
    Unify-Const: i64 ~ i64 => {}

==== Typed AST ====
TypedProgram {
    definitions: [
        Import(
            TypedImportDef {
                items: Named(
                    [
                        TypedImportNamedItem {
                            imported: Identifier {
                                name: "blockHeight",
                                span: Some(
                                    9..20,
                                ),
                            },
                            local: Identifier {
                                name: "blockHeight",
                                span: Some(
                                    9..20,
                                ),
                            },
                            ty: Function {
                                params: [],
                                result: Int,
                                effect: Runtime,
                            },
                        },
                    ],
                ),
                from: TypedImportSource {
                    namespace: Identifier {
                        name: "starstream",
                        span: Some(
                            28..38,
                        ),
                    },
                    package: Identifier {
                        name: "std",
                        span: Some(
                            39..42,
                        ),
                    },
                    interface: Some(
                        Identifier {
                            name: "cardano",
                            span: Some(
                                43..50,
                            ),
                        },
                    ),
                },
            },
        ),
        Function(
            TypedFunctionDef {
                export: Some(
                    Script,
                ),
                name: Identifier {
                    name: "reexport",
                    span: Some(
                        63..71,
                    ),
                },
                params: [],
                return_type: Int,
                body: TypedBlock {
                    statements: [],
                    tail_expression: Some(
                        Spanned {
                            node: TypedExpr {
                                ty: Int,
                                kind: Runtime {
                                    expr: Spanned {
                                        node: TypedExpr {
                                            ty: Int,
                                            kind: Call {
                                                callee: Spanned {
                                                    node: TypedExpr {
                                                        ty: Function {
                                                            params: [],
                                                            result: Int,
                                                            effect: Runtime,
                                                        },
                                                        kind: Identifier(
                                                            Identifier {
                                                                name: "blockHeight",
                                                                span: Some(
                                                                    95..106,
                                                                ),
                                                            },
                                                        ),
                                                    },
                                                    span: 95..106,
                                                    comments_before: [],
                                                    comments_after: [],
                                                },
                                                args: [],
                                            },
                                        },
                                        span: 95..109,
                                        comments_before: [],
                                        comments_after: [],
                                    },
                                },
                            },
                            span: 87..109,
                            comments_before: [],
                            comments_after: [],
                        },
                    ),
                },
            },
        ),
    ],
}

==== Core WebAssembly ====
(module
  (type (;0;) (func (result i64)))
  (import "starstream:std/cardano" "block-height" (func (;0;) (type 0)))
  (export "reexport" (func 0))
  (func (;1;) (type 0) (result i64)
    (call 0)
  )
  (@custom "component-type"
    (component
      (@custom "wit-component-encoding" "\04\00")
      (type (;0;)
        (component
          (type (;0;)
            (component
              (type (;0;) (func (result s64)))
              (export (;0;) "reexport" (func (type 0)))
              (type (;1;)
                (instance
                  (type (;0;) (func (result s64)))
                  (export (;0;) "block-height" (func (type 0)))
                )
              )
              (import "starstream:std/cardano" (instance (;0;) (type 1)))
            )
          )
          (export (;0;) "my-namespace:my-package/my-world" (component (type 0)))
        )
      )
      (export (;1;) "x" (type 0))
    )
  )
)

==== WIT ====
package root:component;

world root {
  import starstream:std/cardano;

  export reexport: func() -> s64;
}
