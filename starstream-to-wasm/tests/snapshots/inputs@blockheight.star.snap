---
source: starstream-to-wasm/tests/snapshots.rs
input_file: starstream-to-wasm/tests/inputs/blockheight.star
---
==== AST ====
Program {
    shebang: None,
    definitions: [
        Spanned {
            node: Import(
                ImportDef {
                    items: Named(
                        [
                            ImportNamedItem {
                                imported: Identifier {
                                    name: "blockHeight",
                                    span: 9..20,
                                },
                                local: Identifier {
                                    name: "blockHeight",
                                    span: 9..20,
                                },
                            },
                        ],
                    ),
                    from: ImportSource {
                        namespace: Identifier {
                            name: "starstream",
                            span: 28..38,
                        },
                        package: Identifier {
                            name: "std",
                            span: 39..42,
                        },
                        interface: Some(
                            Identifier {
                                name: "cardano",
                                span: 43..50,
                            },
                        ),
                    },
                },
            ),
            span: 0..53,
        },
        Spanned {
            node: Function(
                FunctionDef {
                    export: Some(
                        Script,
                    ),
                    name: Identifier {
                        name: "reexport",
                        span: 63..71,
                    },
                    params: [],
                    return_type: Some(
                        TypeAnnotation {
                            name: Identifier {
                                name: "i64",
                                span: 77..80,
                            },
                            generics: [],
                        },
                    ),
                    body: Block {
                        statements: [
                            Spanned {
                                node: Expression(
                                    Spanned {
                                        node: Runtime {
                                            expr: Spanned {
                                                node: Call {
                                                    callee: Spanned {
                                                        node: Identifier(
                                                            Identifier {
                                                                name: "blockHeight",
                                                                span: 95..106,
                                                            },
                                                        ),
                                                        span: 95..106,
                                                    },
                                                    args: [],
                                                },
                                                span: 95..108,
                                            },
                                        },
                                        span: 87..108,
                                    },
                                ),
                                span: 87..114,
                            },
                        ],
                        tail_expression: Some(
                            Spanned {
                                node: Runtime {
                                    expr: Spanned {
                                        node: Call {
                                            callee: Spanned {
                                                node: Identifier(
                                                    Identifier {
                                                        name: "blockHeight",
                                                        span: 122..133,
                                                    },
                                                ),
                                                span: 122..133,
                                            },
                                            args: [],
                                        },
                                        span: 122..136,
                                    },
                                },
                                span: 114..136,
                            },
                        ),
                        span: 81..139,
                    },
                },
            ),
            span: 53..139,
        },
        Spanned {
            node: Function(
                FunctionDef {
                    export: Some(
                        Script,
                    ),
                    name: Identifier {
                        name: "second",
                        span: 149..155,
                    },
                    params: [],
                    return_type: Some(
                        TypeAnnotation {
                            name: Identifier {
                                name: "i64",
                                span: 161..164,
                            },
                            generics: [],
                        },
                    ),
                    body: Block {
                        statements: [],
                        tail_expression: Some(
                            Spanned {
                                node: Call {
                                    callee: Spanned {
                                        node: Identifier(
                                            Identifier {
                                                name: "reexport",
                                                span: 171..179,
                                            },
                                        ),
                                        span: 171..179,
                                    },
                                    args: [],
                                },
                                span: 171..182,
                            },
                        ),
                        span: 165..184,
                    },
                },
            ),
            span: 139..184,
        },
    ],
}

==== Inference trace ====

T-Fn: reexport => i64
  T-Expr: {blockHeight: runtime fn() -> i64} ⊢ runtime blockHeight(); ⇒ ()
    T-Runtime: {blockHeight: runtime fn() -> i64} ⊢ runtime blockHeight() ⇒ i64
      T-Call: {blockHeight: runtime fn() -> i64} ⊢ blockHeight() ⇒ i64
        T-Var: {blockHeight: runtime fn() -> i64} ⊢ blockHeight ⇒ runtime fn() -> i64
  T-ReturnTail: runtime blockHeight() => i64
    T-Runtime: {blockHeight: runtime fn() -> i64} ⊢ runtime blockHeight() ⇒ i64
      T-Call: {blockHeight: runtime fn() -> i64} ⊢ blockHeight() ⇒ i64
        T-Var: {blockHeight: runtime fn() -> i64} ⊢ blockHeight ⇒ runtime fn() -> i64
    Unify-Const: i64 ~ i64 => {}

T-Fn: second => i64
  T-ReturnTail: reexport() => i64
    T-Call: {blockHeight: runtime fn() -> i64} ⊢ reexport() ⇒ i64
      T-Var: {blockHeight: runtime fn() -> i64} ⊢ reexport ⇒ fn() -> i64
    Unify-Const: i64 ~ i64 => {}

==== Typed AST ====
TypedProgram {
    definitions: [
        Import(
            TypedImportDef {
                items: Named(
                    [
                        TypedImportNamedItem {
                            imported: Identifier {
                                name: "blockHeight",
                                span: 9..20,
                            },
                            local: Identifier {
                                name: "blockHeight",
                                span: 9..20,
                            },
                            ty: Function {
                                params: [],
                                result: Int(
                                    I64,
                                ),
                                effect: Runtime,
                            },
                        },
                    ],
                ),
                from: TypedImportSource {
                    namespace: Identifier {
                        name: "starstream",
                        span: 28..38,
                    },
                    package: Identifier {
                        name: "std",
                        span: 39..42,
                    },
                    interface: Some(
                        Identifier {
                            name: "cardano",
                            span: 43..50,
                        },
                    ),
                },
            },
        ),
        Function(
            TypedFunctionDef {
                export: Some(
                    Script,
                ),
                name: Identifier {
                    name: "reexport",
                    span: 63..71,
                },
                params: [],
                return_type: Int(
                    I64,
                ),
                effect: Pure,
                body: TypedBlock {
                    statements: [
                        Expression(
                            Spanned {
                                node: TypedExpr {
                                    ty: Int(
                                        I64,
                                    ),
                                    kind: Runtime {
                                        expr: Spanned {
                                            node: TypedExpr {
                                                ty: Int(
                                                    I64,
                                                ),
                                                kind: Call {
                                                    callee: Spanned {
                                                        node: TypedExpr {
                                                            ty: Function {
                                                                params: [],
                                                                result: Int(
                                                                    I64,
                                                                ),
                                                                effect: Runtime,
                                                            },
                                                            kind: Identifier(
                                                                Identifier {
                                                                    name: "blockHeight",
                                                                    span: 95..106,
                                                                },
                                                            ),
                                                        },
                                                        span: 95..106,
                                                    },
                                                    args: [],
                                                },
                                            },
                                            span: 95..108,
                                        },
                                    },
                                },
                                span: 87..108,
                            },
                        ),
                    ],
                    tail_expression: Some(
                        Spanned {
                            node: TypedExpr {
                                ty: Int(
                                    I64,
                                ),
                                kind: Runtime {
                                    expr: Spanned {
                                        node: TypedExpr {
                                            ty: Int(
                                                I64,
                                            ),
                                            kind: Call {
                                                callee: Spanned {
                                                    node: TypedExpr {
                                                        ty: Function {
                                                            params: [],
                                                            result: Int(
                                                                I64,
                                                            ),
                                                            effect: Runtime,
                                                        },
                                                        kind: Identifier(
                                                            Identifier {
                                                                name: "blockHeight",
                                                                span: 122..133,
                                                            },
                                                        ),
                                                    },
                                                    span: 122..133,
                                                },
                                                args: [],
                                            },
                                        },
                                        span: 122..136,
                                    },
                                },
                            },
                            span: 114..136,
                        },
                    ),
                },
            },
        ),
        Function(
            TypedFunctionDef {
                export: Some(
                    Script,
                ),
                name: Identifier {
                    name: "second",
                    span: 149..155,
                },
                params: [],
                return_type: Int(
                    I64,
                ),
                effect: Pure,
                body: TypedBlock {
                    statements: [],
                    tail_expression: Some(
                        Spanned {
                            node: TypedExpr {
                                ty: Int(
                                    I64,
                                ),
                                kind: Call {
                                    callee: Spanned {
                                        node: TypedExpr {
                                            ty: Function {
                                                params: [],
                                                result: Int(
                                                    I64,
                                                ),
                                                effect: Pure,
                                            },
                                            kind: Identifier(
                                                Identifier {
                                                    name: "reexport",
                                                    span: 171..179,
                                                },
                                            ),
                                        },
                                        span: 171..179,
                                    },
                                    args: [],
                                },
                            },
                            span: 171..182,
                        },
                    ),
                },
            },
        ),
    ],
}

==== Core WebAssembly ====
(module
  (type (;0;) (func (result i64)))
  (import "starstream:std/cardano" "block-height" (func (;0;) (type 0)))
  (export "reexport" (func 0))
  (export "second" (func 1))
  (func (;1;) (type 0) (result i64)
    (drop
      (call 0))
    (call 0)
  )
  (func (;2;) (type 0) (result i64)
    (call 0)
  )
  (@custom "component-type"
    (component
      (@custom "wit-component-encoding" "\04\00")
      (type (;0;)
        (component
          (type (;0;)
            (component
              (type (;0;) (func (result s64)))
              (export (;0;) "reexport" (func (type 0)))
              (type (;1;) (func (result s64)))
              (export (;1;) "second" (func (type 1)))
              (type (;2;)
                (instance
                  (type (;0;) (func (result s64)))
                  (export (;0;) "block-height" (func (type 0)))
                )
              )
              (import "starstream:std/cardano" (instance (;0;) (type 2)))
            )
          )
          (export (;0;) "my-namespace:my-package/my-world" (component (type 0)))
        )
      )
      (export (;1;) "x" (type 0))
    )
  )
)

==== WIT ====
package root:component;

world root {
  import starstream:std/cardano;

  export reexport: func() -> s64;
  export second: func() -> s64;
}
package starstream:std {
  interface cardano {
    block-height: func() -> s64;
  }
}
