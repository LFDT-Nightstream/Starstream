---
source: starstream-to-wasm/tests/snapshots.rs
input_file: starstream-to-wasm/tests/inputs/if_elseif_else.star
---
==== AST ====
Program {
    shebang: None,
    definitions: [
        Spanned {
            node: Function(
                FunctionDef {
                    export: Some(
                        Script,
                    ),
                    name: Identifier {
                        name: "main",
                        span: Some(
                            10..14,
                        ),
                    },
                    params: [],
                    return_type: None,
                    body: Block {
                        statements: [],
                        tail_expression: Some(
                            Spanned {
                                node: If {
                                    branches: [
                                        (
                                            Spanned {
                                                node: Literal(
                                                    Boolean(
                                                        false,
                                                    ),
                                                ),
                                                span: 27..32,
                                                comments_before: [],
                                                comments_after: [],
                                            },
                                            Block {
                                                statements: [
                                                    Spanned {
                                                        node: Expression(
                                                            Spanned {
                                                                node: Literal(
                                                                    Integer(
                                                                        1,
                                                                    ),
                                                                ),
                                                                span: 44..45,
                                                                comments_before: [],
                                                                comments_after: [],
                                                            },
                                                        ),
                                                        span: 44..51,
                                                        comments_before: [],
                                                        comments_after: [],
                                                    },
                                                ],
                                                tail_expression: None,
                                            },
                                        ),
                                        (
                                            Spanned {
                                                node: Literal(
                                                    Boolean(
                                                        true,
                                                    ),
                                                ),
                                                span: 62..66,
                                                comments_before: [],
                                                comments_after: [],
                                            },
                                            Block {
                                                statements: [
                                                    Spanned {
                                                        node: Expression(
                                                            Spanned {
                                                                node: Literal(
                                                                    Integer(
                                                                        2,
                                                                    ),
                                                                ),
                                                                span: 78..79,
                                                                comments_before: [],
                                                                comments_after: [],
                                                            },
                                                        ),
                                                        span: 78..85,
                                                        comments_before: [],
                                                        comments_after: [],
                                                    },
                                                ],
                                                tail_expression: None,
                                            },
                                        ),
                                    ],
                                    else_branch: Some(
                                        Block {
                                            statements: [
                                                Spanned {
                                                    node: Expression(
                                                        Spanned {
                                                            node: Literal(
                                                                Integer(
                                                                    3,
                                                                ),
                                                            ),
                                                            span: 102..103,
                                                            comments_before: [],
                                                            comments_after: [],
                                                        },
                                                    ),
                                                    span: 102..109,
                                                    comments_before: [],
                                                    comments_after: [],
                                                },
                                            ],
                                            tail_expression: None,
                                        },
                                    ),
                                },
                                span: 23..111,
                                comments_before: [],
                                comments_after: [],
                            },
                        ),
                    },
                },
            ),
            span: 0..113,
            comments_before: [],
            comments_after: [],
        },
    ],
}

==== Inference trace ====
T-Fn: main => ()
  T-ReturnTail: if (false) {
    1;
} else if (true) {
    2;
} else {
    3;
} => ()
    T-If: {} ⊢ if (false) {
    1;
} else if (true) {
    2;
} else {
    3;
} ⇒ ()
      T-Bool: {} ⊢ false ⇒ bool
      Check-Bool: bool => ok
      T-Expr: {} ⊢ 1; ⇒ ()
        T-Int: {} ⊢ 1 ⇒ i64
      T-Bool: {} ⊢ true ⇒ bool
      Check-Bool: bool => ok
      T-Expr: {} ⊢ 2; ⇒ ()
        T-Int: {} ⊢ 2 ⇒ i64
      Unify-Const: () ~ () => {}
      T-Expr: {} ⊢ 3; ⇒ ()
        T-Int: {} ⊢ 3 ⇒ i64
      Unify-Const: () ~ () => {}
    Unify-Const: () ~ () => {}

==== Typed AST ====
TypedProgram {
    definitions: [
        Function(
            TypedFunctionDef {
                export: Some(
                    Script,
                ),
                name: Identifier {
                    name: "main",
                    span: Some(
                        10..14,
                    ),
                },
                params: [],
                return_type: Unit,
                effect: Pure,
                body: TypedBlock {
                    statements: [],
                    tail_expression: Some(
                        Spanned {
                            node: TypedExpr {
                                ty: Unit,
                                kind: If {
                                    branches: [
                                        (
                                            Spanned {
                                                node: TypedExpr {
                                                    ty: Bool,
                                                    kind: Literal(
                                                        Boolean(
                                                            false,
                                                        ),
                                                    ),
                                                },
                                                span: 27..32,
                                                comments_before: [],
                                                comments_after: [],
                                            },
                                            TypedBlock {
                                                statements: [
                                                    Expression(
                                                        Spanned {
                                                            node: TypedExpr {
                                                                ty: Int,
                                                                kind: Literal(
                                                                    Integer(
                                                                        1,
                                                                    ),
                                                                ),
                                                            },
                                                            span: 44..45,
                                                            comments_before: [],
                                                            comments_after: [],
                                                        },
                                                    ),
                                                ],
                                                tail_expression: None,
                                            },
                                        ),
                                        (
                                            Spanned {
                                                node: TypedExpr {
                                                    ty: Bool,
                                                    kind: Literal(
                                                        Boolean(
                                                            true,
                                                        ),
                                                    ),
                                                },
                                                span: 62..66,
                                                comments_before: [],
                                                comments_after: [],
                                            },
                                            TypedBlock {
                                                statements: [
                                                    Expression(
                                                        Spanned {
                                                            node: TypedExpr {
                                                                ty: Int,
                                                                kind: Literal(
                                                                    Integer(
                                                                        2,
                                                                    ),
                                                                ),
                                                            },
                                                            span: 78..79,
                                                            comments_before: [],
                                                            comments_after: [],
                                                        },
                                                    ),
                                                ],
                                                tail_expression: None,
                                            },
                                        ),
                                    ],
                                    else_branch: Some(
                                        TypedBlock {
                                            statements: [
                                                Expression(
                                                    Spanned {
                                                        node: TypedExpr {
                                                            ty: Int,
                                                            kind: Literal(
                                                                Integer(
                                                                    3,
                                                                ),
                                                            ),
                                                        },
                                                        span: 102..103,
                                                        comments_before: [],
                                                        comments_after: [],
                                                    },
                                                ),
                                            ],
                                            tail_expression: None,
                                        },
                                    ),
                                },
                            },
                            span: 23..111,
                            comments_before: [],
                            comments_after: [],
                        },
                    ),
                },
            },
        ),
    ],
}

==== Core WebAssembly ====
(module
  (type (;0;) (func))
  (export "main" (func 0))
  (func (;0;) (type 0)
    (block ;; label = @1
      (block ;; label = @2
        (br_if 0 (;@2;)
          (i32.eqz
            (i32.const 0)))
        (br 1 (;@1;)))
      (block ;; label = @2
        (br_if 0 (;@2;)
          (i32.eqz
            (i32.const 1)))
        (br 1 (;@1;))))
  )
  (@custom "component-type"
    (component
      (@custom "wit-component-encoding" "\04\00")
      (type (;0;)
        (component
          (type (;0;)
            (component
              (type (;0;) (func))
              (export (;0;) "main" (func (type 0)))
            )
          )
          (export (;0;) "my-namespace:my-package/my-world" (component (type 0)))
        )
      )
      (export (;1;) "x" (type 0))
    )
  )
)

==== WIT ====
package root:component;

world root {
  export main: func();
}
